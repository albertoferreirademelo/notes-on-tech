---
import { getCollection } from 'astro:content';
import PersonalLayout from '../layouts/PersonalLayout.astro';
import NoteList from '../components/NoteList.astro';
import ProjectCard from '../components/ProjectCard.astro';

// Add new markdown entries in src/content/notes and src/content/projects to populate the sections below.
const allNotes = (await getCollection('notes')).sort(
  (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime(),
);
const latestNotes = allNotes.slice(0, 3);

const allProjects = (await getCollection('projects')).sort(
  (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime(),
);
const latestProjects = allProjects.slice(0, 3);

const base = import.meta.env.BASE_URL || '/';
const normalizeBase = base === '/' ? '' : base.replace(/\/$/, '');
const withBase = (path: string) => (path.startsWith('/') ? `${normalizeBase}${path}` : path);
---
<PersonalLayout title="Alberto Ferreira de Melo" description="Thoughts, experiments, and notes on technology and life.">
  <section class="intro card">
    <h2>Hej, Iâ€™m Alberto.</h2>
      <p>
      This is my digital notebook, a calm space for the projects, prompts and questions that keep me curious.
    </p>
    <p>
      I keep several threads open at once. <br>
      Some turn into essays, others remain rough edges. <br>
      All of them show the work in progress.
    </p>
  </section>

  <section aria-labelledby="latest-notes" class="stack">
    <div class="section-heading">
      <h2 id="latest-notes">Latest notes</h2>
      <a href={withBase('/notes')} class="section-link">See all notes</a>
    </div>
    {latestNotes.length > 0 ? (
      <NoteList notes={latestNotes} />
    ) : (
      <p class="empty">Notes will appear here as soon as I publish the first one.</p>
    )}
    {allNotes.length === 1 && <p class="empty">More notes coming soon.</p>}
  </section>

  <section aria-labelledby="projects" class="stack">
    <div class="section-heading">
      <h2 id="projects">Projects &amp; experiments</h2>
      <p class="section-subtitle">Three fresh snapshots from the workshop table.</p>
    </div>
    {latestProjects.length > 0 ? (
      <div class="project-grid">
        {latestProjects.map((project) => (
          <ProjectCard project={project} />
        ))}
      </div>
    ) : (
      <p class="empty">
        Projects &amp; experiments will appear here as I publish them.
      </p>
    )}
  </section>
</PersonalLayout>

<style>
  .intro h2 {
    margin: 0 0 0.75rem;
    font-family: var(--font-serif);
    font-size: clamp(1.8rem, 3vw + 1rem, 2.4rem);
  }

  .intro p {
    color: var(--color-text-muted);
    max-width: 50ch;
  }

  .stack {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .section-heading {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .section-heading h2 {
    margin: 0;
    font-family: var(--font-serif);
    font-size: 1.6rem;
  }

  .section-link {
    align-self: flex-start;
    font-size: 0.9rem;
    letter-spacing: 0.04em;
  }

  .section-subtitle {
    margin: 0;
    color: var(--color-text-muted);
    font-size: 0.95rem;
  }

  .project-grid {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: repeat(auto-fit, minmax(16rem, 1fr));
  }

  .empty {
    margin: 0;
    color: var(--color-text-muted);
    font-style: italic;
  }
</style>
